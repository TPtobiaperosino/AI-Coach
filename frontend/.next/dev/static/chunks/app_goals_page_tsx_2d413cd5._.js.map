{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/tobiaperosino/Library/CloudStorage/OneDrive-OxfordBrookesUniversity/Microsoft%20Copilot%20Chat%20Files/Tech%20Projects/running-AI-Coach/frontend/app/goals/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport {\n  CognitoIdentityProviderClient,\n  UpdateUserAttributesCommand,\n} from \"@aws-sdk/client-cognito-identity-provider\";\n\nconst client = new CognitoIdentityProviderClient({ region: \"eu-west-2\" });\n\nfunction decodeJwtPayload(token: string) {\n  const [, payload] = token.split(\".\");\n  const normalized = payload.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const json = atob(normalized);\n  return JSON.parse(json);\n}\n\nexport default function GoalsPage() {\n  const [form, setForm] = useState({\n    targetCalories: \"\",\n    targetProtein: \"\",\n    targetCarbs: \"\",\n    targetFat: \"\",\n  });\n  const [status, setStatus] = useState<string | null>(null);\n  const [claims, setClaims] = useState<any>(null);\n\n  useEffect(() => {\n    const idToken = sessionStorage.getItem(\"id_token\");\n    if (idToken) {\n      try {\n        setClaims(decodeJwtPayload(idToken));\n      } catch (e) {\n        console.error(\"Failed to decode id_token\", e);\n      }\n    }\n  }, []);\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    const accessToken = sessionStorage.getItem(\"access_token\");\n    const refreshToken = sessionStorage.getItem(\"refresh_token\");\n    if (!accessToken || !refreshToken) {\n      setStatus(\"Missing tokens. Please login again.\");\n      return;\n    }\n\n    setStatus(\"Saving goals...\");\n    try {\n      await client.send(\n        new UpdateUserAttributesCommand({\n          AccessToken: accessToken,\n          UserAttributes: [\n            { Name: \"custom:targetCalories\", Value: form.targetCalories || \"0\" },\n            { Name: \"custom:targetProtein\", Value: form.targetProtein || \"0\" },\n            { Name: \"custom:targetCarbs\", Value: form.targetCarbs || \"0\" },\n            { Name: \"custom:targetFat\", Value: form.targetFat || \"0\" },\n          ],\n        })\n      );\n\n      const body = new URLSearchParams({\n        grant_type: \"refresh_token\",\n        client_id: \"254veiurhs7i1dng9vf4p64fug\",\n        refresh_token: refreshToken,\n      });\n      const res = await fetch(\n        \"https://ai-coach-user-pool-login.auth.eu-west-2.amazoncognito.com/oauth2/token\",\n        {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n          body: body.toString(),\n        }\n      );\n      if (!res.ok) {\n        const text = await res.text();\n        throw new Error(text);\n      }\n      const tokens = await res.json();\n      sessionStorage.setItem(\"access_token\", tokens.access_token);\n      sessionStorage.setItem(\"id_token\", tokens.id_token);\n      if (tokens.refresh_token) {\n        sessionStorage.setItem(\"refresh_token\", tokens.refresh_token);\n      }\n      try {\n        setClaims(decodeJwtPayload(tokens.id_token));\n      } catch (err) {\n        console.error(\"Failed to decode refreshed id_token\", err);\n      }\n      setStatus(\"Goals saved and tokens refreshed.\");\n    } catch (err: any) {\n      setStatus(`Update failed: ${err.message ?? String(err)}`);\n    }\n  }\n\n  return (\n    <main style={{ maxWidth: 420, margin: \"40px auto\", display: \"flex\", flexDirection: \"column\", gap: 12 }}>\n      <h1>Set your goals</h1>\n      <form onSubmit={handleSubmit} style={{ display: \"flex\", flexDirection: \"column\", gap: 8 }}>\n        <input\n          type=\"number\"\n          placeholder=\"Target calories\"\n          value={form.targetCalories}\n          onChange={(e) => setForm({ ...form, targetCalories: e.target.value })}\n        />\n        <input\n          type=\"number\"\n          placeholder=\"Target protein\"\n          value={form.targetProtein}\n          onChange={(e) => setForm({ ...form, targetProtein: e.target.value })}\n        />\n        <input\n          type=\"number\"\n          placeholder=\"Target carbs\"\n          value={form.targetCarbs}\n          onChange={(e) => setForm({ ...form, targetCarbs: e.target.value })}\n        />\n        <input\n          type=\"number\"\n          placeholder=\"Target fat\"\n          value={form.targetFat}\n          onChange={(e) => setForm({ ...form, targetFat: e.target.value })}\n        />\n        <button type=\"submit\">Save goals</button>\n      </form>\n      {status && <p>{status}</p>}\n      {claims && (\n        <pre style={{ background: \"#f5f5f5\", padding: 12, borderRadius: 4 }}>\n          {JSON.stringify(\n            {\n              email: claims.email,\n              custom: {\n                targetCalories: claims[\"custom:targetCalories\"],\n                targetProtein: claims[\"custom:targetProtein\"],\n                targetCarbs: claims[\"custom:targetCarbs\"],\n                targetFat: claims[\"custom:targetFat\"],\n              },\n            },\n            null,\n            2\n          )}\n        </pre>\n      )}\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}